---
# defaults file for ansible-role-nextcloud-docker

#
# docker-compose variables.
#
nd_docker_compose_project: "nextcloud"
nd_docker_compose_project_dir: "/tmp/{{ nd_docker_compose_project }}"
nd_docker_compose_project_src: "files/docker-compose"
nd_docker_compose_remove_project: true

#
# Role configuration options.
#
nd_allow_insecure_defaults: false
nd_use_proxy: true
nd_use_letsencrypt: true
nd_use_redis: true
nd_use_cron: true
nd_domain_name: "example.local"
nd_configure_nextcloud_custom_file: "nd-configure-nextcloud-custom.yml"

#
# Service passwords.
#
nd_postgres_password: "insecure"
nd_redis_host_password: "insecure"
nd_nextcloud_admin_password: "insecure"

#
# Service environment vars and volumes.
#

#
# Letsencrypt
#
# Env vars.
nd_letsencrypt_env_vars:
  - name: "LETSENCRYPT_HOST"
    value: "{{ nd_domain_name }}"
  - name: "LETSENCRYPT_EMAIL"
    value: "admin@example.local"

# Volumes.
nd_letsencrypt_required_volumes:
  - "certs:/etc/nginx/certs"
  - "/var/run/docker.sock:/var/run/docker.sock:ro"

#
# PostgreSQL
#
nd_postgres_database: "nextcloud"
nd_postgres_host: "db"
nd_postgres_user: "nextcloud"

# Env vars.
nd_postgres_env_vars:
  - name: "POSTGRES_DB"
    value: "{{ nd_postgres_database }}"
  - name: "POSTGRES_HOST"
    value: "{{ nd_postgres_host }}"
  - name: "POSTGRES_PASSWORD"
    value: "{{ nd_postgres_password }}"
  - name: "POSTGRES_USER"
    value: "{{ nd_postgres_user }}"

# Volumes.
nd_postgres_required_volumes:
  - "db:/var/lib/postgresql/data"

#
# Nextcloud
#
# Env vars.
nd_nextcloud_env_vars:
  - name: "VIRTUAL_HOST"
    value: "{{ nd_domain_name }}"
  - name: "POSTGRES_HOST"
    value: "db"

# Volumes.
nd_nextcloud_required_volumes:
  - "nextcloud:/var/www/html"
  # - "/var/nextcloud/config:/var/www/html/config"
  # - "/var/nextcloud/custom_apps:/var/www/html/custom_apps"
  # - "/var/nextcloud/data:/var/www/html/data"
  # - "/var/nextcloud/themes:/var/www/html/themes"

#
# Nginx Proxy
#
# Volumes.
nd_nginx_proxy_required_volumes:
  - "vhost.d:/etc/nginx/vhost.d"
  - "html:/usr/share/nginx/html"
  - "/var/run/docker.sock:/tmp/docker.sock:ro"
  # - "/var/nextcloud/proxy/conf.d:/etc/nginx/conf.d"

#
# Redis
#
# Env vars.
nd_redis_env_vars:
  - name: "REDIS_HOST"
    value: "redis"
  - name: "REDIS_HOST_PORT"
    value: "6379"
  - name: "REDIS_HOST_PASSWORD"
    value: "{{ nd_redis_host_password }}"

#
# Nextcloud install, setup related vars.
#
nd_nextcloud_admin_user: "admin"

nd_nextcloud_occ_prefix: >-
  docker exec --user www-data {{ nd_docker_compose_project }}_app_1

nd_nextcloud_trusted_domains:
  - "localhost"
  - "{{ nd_domain_name }}"

nd_nextcloud_occ_install: >
  php occ maintenance:install
  --database="pgsql"
  --database-host="{{ nd_postgres_host }}"
  --database-name="{{ nd_postgres_database }}"
  --database-user="{{ nd_postgres_user }}"
  --database-pass="{{ nd_postgres_password }}"
  --admin-user="{{ nd_nextcloud_admin_user }}"
  --admin-pass="{{ nd_nextcloud_admin_password }}"

nd_nextcloud_encryption_enabled: false
nd_nextcloud_encryption_module: "encryption"
